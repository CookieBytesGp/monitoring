@model App.ViewComponents.TopMenuViewModel

<div class="top-menu">
    <h1>Page Editor</h1>
    <button id="finalSaveButton" class="btn btn-success" onclick="FinalSave()">Final Save</button>
</div>

<script type="text/javascript">
    const FinalSave = () => {
        fetch('@Url.Action("FinalSave", "PageEditor")', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Failed to save page. Server returned status code: ${response.status}`);
                }

                const contentType = response.headers.get("Content-Type");
                if (contentType && contentType.includes("application/json")) {
                    return response.json(); // Parse as JSON if the response is JSON
                } else {
                    return response.text(); // Fallback to plain text
                }
            })
            .then(data => {
                console.log("Final save response:", data);
                alert(data); // Show the response in an alert (whether JSON or plain text)
            })
            .catch(error => {
                console.error("Error during final save:", error);
                alert(`Error during final save: ${error.message}`);
            });
    };

</script>
